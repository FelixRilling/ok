<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Ok.js Demo</title>

		<style>
			/**
	   * Base
	   */
			body {
				display: flex;
				justify-content: center;
				align-items: center;
			}

			.container {
				padding-left: 1rem;
				padding-right: 1rem;
			}

			section {
				padding: 0 1rem;
			}

			/**
	   * Inputs
	   */
			.form {
				padding: 1rem;
				border: 1px solid #bbb;
			}

			.form-group {
				margin-bottom: 0.75rem;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<section>
				<h1>Demo 1 - Basic Inputs</h1>
				<form class="form" id="demo1">
					<div class="form-group">
						<label for="demo1_1">
							First Name (only "Dave" allowed)
						</label>
						<input
							id="demo1_1"
							type="text"
							required
							data-ok="nameFirst"
						/>
					</div>

					<div class="form-group">
						<label for="demo1_2">
							Last Name (not validated, anything goes)
						</label>
						<input id="demo1_2" type="text" required />
					</div>

					<div class="form-group">
						<label for="demo1_3">
							Email address (only ".de" allowed)
						</label>
						<input
							id="demo1_3"
							type="email"
							required
							data-ok="emailDe"
						/>
					</div>

					<input type="submit" />
				</form>
				<script type="module">
					import { Ok } from "/lib/main.ts";

					/**
					 * Create Ok instance with custom validators.
					 */
					const ok = new Ok({
						nameFirst: {
							msg: "Only 'Dave' allowed",
							fn: (element) => element.value === "Dave",
						},
						emailDe: {
							msg: (element) =>
								`Please input your .de email (You entered '${element.value}')`,
							fn: (element) => element.value.endsWith(".de"),
						},
					});

					/**
					 * Bind validation event handlers to inputs.
					 */
					document
						.querySelectorAll("#demo1 [data-ok]")
						.forEach((el) => {
							el.addEventListener("input", (e) =>
								ok.validate(e.target),
							);
						});
				</script>
			</section>

			<section>
				<h1>Demo 2 - Chaining</h1>
				<form class="form" id="demo2">
					<div class="form-group">
						<label for="demo2_1"
							>Email ID (all caps and ending in .de)</label
						>
						<input
							id="demo2_1"
							type="email"
							required
							data-ok="nameCaps,emailDe"
						/>
					</div>
					<input type="submit" />
				</form>
				<script type="module">
					import { Ok } from "/lib/main.ts";

					const ok = new Ok({
						nameCaps: {
							msg: "Must be in all caps",
							fn: (element) =>
								element.value.toUpperCase() === element.value,
						},
						emailDe: {
							msg: "Must end with '.de'",
							fn: (element) => /.+\.de$/i.test(element.value),
						},
					});

					Array.from(
						document.querySelectorAll("#demo2 [data-ok]"),
					).forEach((inputElement) => {
						inputElement.addEventListener("input", (e) =>
							ok.validate(e.target),
						);
					});
				</script>
			</section>

			<section>
				<h1>Demo 3 - Message customization</h1>
				<form class="form" id="demo3">
					<div class="form-group">
						<label for="demo3_1"
							>First Name (Only 'Dave' allowed)</label
						>
						<input
							type="text"
							id="demo3_1"
							required
							data-ok="nameFirst"
						/>
					</div>
					<input type="submit" />
				</form>
				<script type="module">
					import { Ok } from "/lib/main.ts";

					const getLocalizedStringDummy = (key) => {
						const lang = navigator.language;
						if (key === "validator.dave") {
							return `Only 'Dave' allowed (Imagine this text is translated to the language '${lang}')`;
						}
						return "Unknown message";
					};

					const ok = new Ok({
						nameFirst: {
							msg: () =>
								getLocalizedStringDummy("validator.dave"),
							fn: (element) => element.value === "Dave",
						},
					});

					document
						.querySelectorAll("#demo3 [data-ok]")
						.forEach((inputElement) =>
							inputElement.addEventListener("input", (e) =>
								ok.validate(e.target),
							),
						);
				</script>
			</section>

			<section>
				<h1>Demo 4 - Composition</h1>
				<form class="form" id="demo4">
					<div class="form-group">
						<label for="demo4_1">
							First Name (Only 'Dave' allowed)
						</label>
						<input type="text" id="demo4_1" />
					</div>
					<input type="submit" />
				</form>
				<script type="module">
					import { validate } from "/lib/main.ts";

					const nameFirst = {
						msg: "Only 'Dave' allowed",
						fn: (element) => element.value === "Dave",
					};

					document
						.querySelector("#demo4_1")
						.addEventListener("input", (e) =>
							validate(e.target, [nameFirst]),
						);
				</script>
			</section>
		</div>
	</body>
</html>
